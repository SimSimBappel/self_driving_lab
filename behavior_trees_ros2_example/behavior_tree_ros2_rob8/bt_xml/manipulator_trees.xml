<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <BehaviorTree ID="grasp_pose_msg">
    <Sequence>
      <Sleep msec="200"/>
      <ArmPoseMsgOffsetCalculation offset="{approch_offset}"
                                   pose="{target_pose_msg}"
                                   pose_w_offset="{approch_pose}"/>
      <GripperJointAction joint_2="0.04"
                          speed="0.02"
                          accel="0.02"
                          joint_1="0.04"
                          action_name="__default__placeholder__"/>
      <Sleep msec="200"/>
      <ArmMovePoseMsgAction pose="{approch_pose}"
                            speed="0.2"
                            accel="0.2"
                            keep_orientation="false"
                            action_name="__default__placeholder__"/>
      <ClearOctomapNode service_name="__default__placeholder__"/>
      <ArmMovePlizLinPoseMsgAction pose="{target_pose_msg}"
                                   speed="0.025"
                                   accel="0.025"
                                   action_name="__default__placeholder__"/>
      <Sleep msec="200"/>
      <AttachObjectNode object_id="{object_id}"
                        service_name="__default__placeholder__"/>
      <Sleep msec="200"/>
      <Fallback>
        <SubTree ID="gripping"
                 width="0.02"
                 speed="0.03"
                 force="3"
                 epsilon="0.02"/>
        <Sequence>
          <Sleep msec="1000"/>
          <SubTree ID="gripping"
                   width="0.02"
                   speed="0.03"
                   force="3"
                   epsilon="0.02"/>
        </Sequence>
      </Fallback>
      <Sleep msec="200"/>
      <ClearOctomapNode service_name="__default__placeholder__"/>
      <ArmMovePlizLinPoseMsgAction pose="{approch_pose}"
                                   speed="0.025"
                                   accel="0.025"
                                   action_name="__default__placeholder__"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="gripping">
    <Fallback>
      <FrankaGraspGripperAction width="{width}"
                                speed="{speed}"
                                force="{force}"
                                epsilon="{epsilon}"
                                action_name="__default__placeholder__"/>
      <FrankaGraspGripperAction width="{width}"
                                speed="{speed}"
                                force="{force}"
                                epsilon="{epsilon}"
                                action_name="__default__placeholder__"/>
    </Fallback>
  </BehaviorTree>

  <BehaviorTree ID="haptic_calibration">
    <Sequence>
      <AlwaysSuccess/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="init">
    <Sequence>
      <ClearOctomapNode service_name="__default__placeholder__"/>
      <HomeArmAction action_name="__default__placeholder__"/>
      <FrankaHomeGripperAction action_name="__default__placeholder__"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="place_pose_msg">
    <Sequence>
      <Sleep msec="200"/>
      <ArmPoseMsgOffsetCalculation offset="{approach_offset}"
                                   pose="{target_pose_msg}"
                                   pose_w_offset="{approach_pose}"/>
      <Sleep msec="200"/>
      <ArmMovePoseMsgAction pose="{approach_pose}"
                            speed="0.2"
                            accel="0.2"
                            keep_orientation="false"
                            action_name="__default__placeholder__"/>
      <DetachObjectNode object_id="{object_id}"
                        service_name="__default__placeholder__"/>
      <RemoveObjectNode object_id="{object_id}"
                        service_name="__default__placeholder__"/>
      <ClearOctomapNode service_name="__default__placeholder__"/>
      <Sleep msec="200"/>
      <ArmMovePlizLinPoseMsgAction pose="{target_pose_msg}"
                                   speed="0.05"
                                   accel="0.05"
                                   action_name="__default__placeholder__"/>
      <Sleep msec="200"/>
      <FrankaMoveGripperAction width="0.04"
                               speed="0.03"
                               action_name="__default__placeholder__"/>
      <Sleep msec="200"/>
      <ClearOctomapNode service_name="__default__placeholder__"/>
      <ArmMovePlizLinPoseMsgAction pose="{approach_pose}"
                                   speed="0.1"
                                   accel="0.1"
                                   action_name="__default__placeholder__"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="visual_calibration">
    <Sequence>
      <AlwaysSuccess/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="visual_grasp">
    <Sequence>
      <ArmMovePoseMsgAction pose="{lookout_pose_msg}"
                            speed="0.2"
                            accel="0.2"
                            keep_orientation="{keep_orientation}"
                            action_name="__default__placeholder__"/>
      <ArucoAction id="{aruco_id}"
                   aruco_to_slot_transform="{aruco_to_slot}"
                   slot_to_slot_transform="{slot_to_slot}"
                   Transform="{object_pose_msg}"
                   action_name="__default__placeholder__"/>
      <LookupTransformNode result="{bool_result}"
                           transform="{object_pose_msg2}"
                           source="grab_pose"
                           target="panda_link0"
                           service_name="__default__placeholder__"/>
      <AddObjectNode pose="{object_pose_msg2}"
                     object_id="{aruco_id}"
                     shape="cylinder"
                     size_x="0.02"
                     size_y="0.16"
                     service_name="__default__placeholder__"/>
      <SubTree ID="grasp_pose_msg"
               target_pose_msg="{object_pose_msg2}"
               approch_offset="{approach_offset}"
               object_id="{aruco_id}"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="visual_place">
    <Sequence>
      <ArmMovePoseMsgAction pose="{lookout_pose_msg}"
                            speed="0.2"
                            accel="0.2"
                            keep_orientation="{keep_orientation}"
                            action_name="__default__placeholder__"/>
      <ArucoAction id="{aruco_id}"
                   aruco_to_slot_transform="{aruco_to_slot}"
                   slot_to_slot_transform="{slot_to_slot}"
                   Transform="{object_pose_msg}"
                   action_name="__default__placeholder__"/>
      <LookupTransformNode result="{bool_result}"
                           transform="{object_pose_msg2}"
                           source="grab_pose"
                           target="panda_link0"
                           service_name="__default__placeholder__"/>
      <SubTree ID="place_pose_msg"
               target_pose_msg="{object_pose_msg2}"
               approach_offset="{approach_offset}"
               object_id="{aruco_id}"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="visual_pour">
    <Sequence>
      <ArmMovePoseMsgAction pose="{vessel_lookout}"
                            speed="0.2"
                            accel="0.2"
                            keep_orientation=""
                            action_name="__default__placeholder__"/>
      <ArucoAction id="{workstation_id}"
                   aruco_to_slot_transform=""
                   slot_to_slot_transform=""
                   Transform="{aruco_pose}"
                   action_name="__default__placeholder__"/>
      <ArmMovePoseMsgAction pose="{aruco_pose}"
                            speed="0.2"
                            accel="0.2"
                            keep_orientation=""
                            action_name="__default__placeholder__"/>
      <ArmMovePoseMsgAction pose="{pour_pose}"
                            speed="0.2"
                            accel="0.2"
                            keep_orientation=""
                            action_name="__default__placeholder__"/>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="AddObjectNode">
      <input_port name="pose"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="object_id"
                  type="signed char"/>
      <input_port name="shape"
                  type="std::string"/>
      <input_port name="size_x"
                  type="double"/>
      <input_port name="size_y"
                  type="double"/>
      <input_port name="service_name"
                  default="__default__placeholder__"
                  type="std::string">Service name</input_port>
    </Action>
    <Action ID="ArmMovePlizLinPoseMsgAction">
      <input_port name="pose"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="speed"
                  type="double"/>
      <input_port name="accel"
                  type="double"/>
      <input_port name="action_name"
                  default="__default__placeholder__"
                  type="std::string">Action server name</input_port>
    </Action>
    <Action ID="ArmMovePoseMsgAction">
      <input_port name="pose"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="speed"
                  type="double"/>
      <input_port name="accel"
                  type="double"/>
      <input_port name="keep_orientation"
                  type="bool"/>
      <input_port name="action_name"
                  default="__default__placeholder__"
                  type="std::string">Action server name</input_port>
    </Action>
    <Action ID="ArmPoseMsgOffsetCalculation">
      <input_port name="offset"
                  type="std::vector&lt;double, std::allocator&lt;double&gt; &gt;"/>
      <input_port name="pose"
                  type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <output_port name="pose_w_offset"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
    </Action>
    <Action ID="ArucoAction">
      <input_port name="id"
                  type="signed char"/>
      <input_port name="aruco_to_slot_transform"
                  type="geometry_msgs::msg::TransformStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="slot_to_slot_transform"
                  type="geometry_msgs::msg::TransformStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <output_port name="Transform"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="action_name"
                  default="__default__placeholder__"
                  type="std::string">Action server name</input_port>
    </Action>
    <Action ID="AttachObjectNode">
      <input_port name="object_id"
                  type="signed char"/>
      <input_port name="service_name"
                  default="__default__placeholder__"
                  type="std::string">Service name</input_port>
    </Action>
    <Action ID="ClearOctomapNode">
      <input_port name="service_name"
                  default="__default__placeholder__"
                  type="std::string">Service name</input_port>
    </Action>
    <Action ID="DetachObjectNode">
      <input_port name="object_id"
                  type="signed char"/>
      <input_port name="service_name"
                  default="__default__placeholder__"
                  type="std::string">Service name</input_port>
    </Action>
    <Action ID="FrankaGraspGripperAction">
      <input_port name="width"
                  type="double"/>
      <input_port name="speed"
                  type="double"/>
      <input_port name="force"
                  type="double"/>
      <input_port name="epsilon"
                  type="double"/>
      <input_port name="action_name"
                  default="__default__placeholder__"
                  type="std::string">Action server name</input_port>
    </Action>
    <Action ID="FrankaHomeGripperAction">
      <input_port name="action_name"
                  default="__default__placeholder__"
                  type="std::string">Action server name</input_port>
    </Action>
    <Action ID="FrankaMoveGripperAction">
      <input_port name="width"
                  type="double"/>
      <input_port name="speed"
                  type="double"/>
      <input_port name="action_name"
                  default="__default__placeholder__"
                  type="std::string">Action server name</input_port>
    </Action>
    <Action ID="GripperJointAction">
      <input_port name="joint_2"
                  type="double"/>
      <input_port name="speed"
                  type="double"/>
      <input_port name="accel"
                  type="double"/>
      <input_port name="joint_1"
                  type="double"/>
      <input_port name="action_name"
                  default="__default__placeholder__"
                  type="std::string">Action server name</input_port>
    </Action>
    <Action ID="HomeArmAction">
      <input_port name="action_name"
                  default="__default__placeholder__"
                  type="std::string">Action server name</input_port>
    </Action>
    <Action ID="LookupTransformNode">
      <output_port name="result"
                   type="bool"/>
      <output_port name="transform"
                   type="geometry_msgs::msg::PoseStamped_&lt;std::allocator&lt;void&gt; &gt;"/>
      <input_port name="source"
                  type="std::string"/>
      <input_port name="target"
                  type="std::string"/>
      <input_port name="service_name"
                  default="__default__placeholder__"
                  type="std::string">Service name</input_port>
    </Action>
    <Action ID="RemoveObjectNode">
      <input_port name="object_id"
                  type="signed char"/>
      <input_port name="service_name"
                  default="__default__placeholder__"
                  type="std::string">Service name</input_port>
    </Action>
    <SubTree ID="grasp_pose_msg"
             editable="true">
      <input_port name="target_pose_msg"/>
      <input_port name="approch_offset"/>
      <input_port name="object_id"/>
    </SubTree>
    <SubTree ID="gripping"
             editable="true">
      <input_port name="width"
                  default="0.02"/>
      <input_port name="speed"
                  default="0.03"/>
      <input_port name="force"
                  default="5"/>
      <input_port name="epsilon"
                  default="0.02"/>
    </SubTree>
    <SubTree ID="place_pose_msg"
             editable="true">
      <input_port name="target_pose_msg"/>
      <input_port name="approach_offset"/>
      <input_port name="object_id"/>
    </SubTree>
  </TreeNodesModel>

</root>
